services:
  gemma-embed-service:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8082:8082"
# Uncomment the lines below to mount SSL certificates from host:
    volumes:
      - ./certs:/app/certs:ro
    environment:
      - NODE_ENV=production
      - PORT=8082
      - USE_SSL=true  # Default to SSL, set to false to disable HTTPS
      - SSL_KEY_PATH=/app/certs/key.pem
      - SSL_CERT_PATH=/app/certs/cert.pem
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "const http = require('http'); const options = { hostname: 'localhost', port: 8082, path: '/health', timeout: 2000 }; const req = http.request(options, (res) => { process.exit(res.statusCode === 200 ? 0 : 1); }); req.on('error', () => process.exit(1)); req.end();"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # Optional: limit resources
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G
